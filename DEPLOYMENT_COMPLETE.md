# Docker Compose å®šæ—¶ä»»åŠ¡é¡¹ç›®å®æ–½å®Œæˆ

## ğŸ‰ é¡¹ç›®åˆ›å»ºæˆåŠŸï¼

æ‚¨çš„Docker Composeå®šæ—¶ä»»åŠ¡è§£å†³æ–¹æ¡ˆå·²ç»å®Œå…¨éƒ¨ç½²å°±ç»ªã€‚

## ğŸ“ å·²åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒé…ç½®æ–‡ä»¶
- âœ… `Dockerfile` - Dockeré•œåƒæ„å»ºé…ç½®
- âœ… `docker-compose.yml` - Docker ComposeæœåŠ¡é…ç½®
- âœ… `.env` - ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
- âœ… `entrypoint.sh` - å®¹å™¨å¯åŠ¨å…¥å£è„šæœ¬
- âœ… `requirements.txt` - Pythonä¾èµ–é…ç½®

### ç®¡ç†è„šæœ¬
- âœ… `start.sh` - ä¸€é”®å¯åŠ¨è„šæœ¬
- âœ… `stop.sh` - åœæ­¢è„šæœ¬  
- âœ… `restart.sh` - é‡å¯è„šæœ¬
- âœ… `status.sh` - çŠ¶æ€æŸ¥çœ‹è„šæœ¬
- âœ… `logs.sh` - æ—¥å¿—æŸ¥çœ‹è„šæœ¬
- âœ… `setup_permissions.bat` - Windowsæƒé™è®¾ç½®è„šæœ¬

### å®¹å™¨å†…è„šæœ¬
- âœ… `scripts/health_check.sh` - å¥åº·æ£€æŸ¥è„šæœ¬
- âœ… `scripts/setup_cron.sh` - å®šæ—¶ä»»åŠ¡ç®¡ç†è„šæœ¬

### æ–‡æ¡£
- âœ… `README_DOCKER.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜

### ç›®å½•ç»“æ„
- âœ… `logs/` - æ—¥å¿—æ–‡ä»¶ç›®å½•
- âœ… `data/` - æ•°æ®æŒä¹…åŒ–ç›®å½•
- âœ… `scripts/` - è„šæœ¬æ–‡ä»¶ç›®å½•

## ğŸš€ å¿«é€Ÿå¯åŠ¨æŒ‡å—

### åœ¨Linux/WSLç¯å¢ƒä¸­ï¼š

```bash
# 1. è®¾ç½®è„šæœ¬æ‰§è¡Œæƒé™
chmod +x *.sh
chmod +x scripts/*.sh
chmod +x entrypoint.sh

# 2. å¯åŠ¨å®¹å™¨
./start.sh

# 3. æŸ¥çœ‹çŠ¶æ€
./status.sh

# 4. æŸ¥çœ‹æ—¥å¿—
./logs.sh all
```

### åœ¨Windowsç¯å¢ƒä¸­ï¼š

```bash
# 1. è¿è¡Œæƒé™è®¾ç½®è„šæœ¬
setup_permissions.bat

# 2. ä½¿ç”¨Docker Composeç›´æ¥å¯åŠ¨
docker-compose build
docker-compose up -d

# 3. æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# 4. æŸ¥çœ‹æ—¥å¿—
docker logs cron-tasks
```

## âš™ï¸ å®šæ—¶ä»»åŠ¡é…ç½®

é»˜è®¤é…ç½®ï¼ˆå¯åœ¨`.env`æ–‡ä»¶ä¸­ä¿®æ”¹ï¼‰ï¼š

| ä»»åŠ¡ | é»˜è®¤è°ƒåº¦ | è¯´æ˜ |
|------|----------|------|
| Task1 | `0 */2 * * *` | æ¯2å°æ—¶æ‰§è¡Œä¸€æ¬¡ |
| Task2 | `*/30 * * * *` | æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ |
| Task3 | `0 9 * * 1` | æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹æ‰§è¡Œ |

## ğŸ” ç›‘æ§å’Œç®¡ç†

### å¥åº·æ£€æŸ¥
- è‡ªåŠ¨å¥åº·æ£€æŸ¥æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
- æ£€æŸ¥cronæœåŠ¡ã€æ—¥å¿—æ–‡ä»¶ã€ç£ç›˜ç©ºé—´ç­‰
- æ‰‹åŠ¨æ‰§è¡Œï¼š`docker exec cron-tasks /app/scripts/health_check.sh`

### æ—¥å¿—ç®¡ç†
- ä»»åŠ¡æ—¥å¿—ï¼š`./logs/task1.log`, `./logs/task2.log`, `./logs/task3.log`
- å¥åº·æ—¥å¿—ï¼š`./logs/health.log`
- å®¹å™¨æ—¥å¿—ï¼š`docker logs cron-tasks`

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡åˆ—è¡¨
docker exec cron-tasks crontab -l

# è¿›å…¥å®¹å™¨
docker exec -it cron-tasks bash

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
./logs.sh -f task1

# ç®¡ç†å®šæ—¶ä»»åŠ¡
docker exec cron-tasks /app/scripts/setup_cron.sh list
```

## ğŸ“ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹å®šæ—¶è°ƒåº¦
ç¼–è¾‘`.env`æ–‡ä»¶ï¼š
```bash
TASK1_SCHEDULE=*/5 * * * *    # æ”¹ä¸ºæ¯5åˆ†é’Ÿ
TASK2_SCHEDULE=0 */6 * * *    # æ”¹ä¸ºæ¯6å°æ—¶
TASK3_SCHEDULE=0 0 * * *      # æ”¹ä¸ºæ¯å¤©åˆå¤œ
```

### æ·»åŠ Pythonä¾èµ–
ç¼–è¾‘`requirements.txt`ï¼Œç„¶åé‡æ–°æ„å»ºï¼š
```bash
docker-compose build --no-cache
docker-compose up -d
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æ£€æŸ¥å®¹å™¨çŠ¶æ€**ï¼š`docker ps`
2. **æŸ¥çœ‹å®¹å™¨æ—¥å¿—**ï¼š`docker logs cron-tasks`
3. **æ‰§è¡Œå¥åº·æ£€æŸ¥**ï¼š`docker exec cron-tasks /app/scripts/health_check.sh`
4. **æ£€æŸ¥å®šæ—¶ä»»åŠ¡**ï¼š`docker exec cron-tasks crontab -l`
5. **æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—**ï¼š`./logs.sh task1`

## ğŸ¯ ä¸‹ä¸€æ­¥

1. æ ¹æ®éœ€è¦ä¿®æ”¹ä¸‰ä¸ªtaskç›®å½•ä¸­çš„`main.py`è„šæœ¬
2. åœ¨`.env`æ–‡ä»¶ä¸­è°ƒæ•´å®šæ—¶è°ƒåº¦é…ç½®
3. è¿è¡Œ`./start.sh`å¯åŠ¨å®¹å™¨
4. ä½¿ç”¨`./status.sh`ç›‘æ§è¿è¡ŒçŠ¶æ€
5. é€šè¿‡`./logs.sh`æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒï¼š`README_DOCKER.md`

---

**æ­å–œï¼æ‚¨çš„Dockerå®šæ—¶ä»»åŠ¡è§£å†³æ–¹æ¡ˆå·²ç»éƒ¨ç½²å®Œæˆï¼** ğŸ‰

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªå¼ºå¤§ã€çµæ´»ã€æ˜“äºç®¡ç†çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿäº†ã€‚